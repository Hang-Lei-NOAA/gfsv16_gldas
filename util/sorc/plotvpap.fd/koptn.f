      SUBROUTINE KOPTN(KRUN,IOPTN,NOLVSR,LVLSAL,LDZDTQ,LDZNEW,ITOUT,
     X                 WATPAP,IDUMPT)
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C                .      .    .                                       .
C SUBPROGRAM:    KOPTN                SELECT PLOT
C   PRGMMR:LIN               ORG: W/NMC412   DATE: 97-01-29
C
C ABSTRACT: READS DATA FILES AS INDICATED BY THE SWITCHES SET
C   IN /LFILES/.
C
C PROGRAM HISTORY LOG:
C   YY-MM-DD  ORIGINAL AUTHOR  UNKNOWN
C   89-04-25  STEVE LILLY  ADD DOCUMENTATION BLOCK
C   93-05-11  LILLY CONVERT SUB. TO FORTRAN 77
C   97-01-29  LIN   CONVERT SUB. TO CFT-77
C
C USAGE:    CALL KOPTN(KRUN,IOPTN,NOLVSR,LVLSAL,LDZDTQ,LDZNEW
C          &           ITOUT,WATPAP,IDUMPT)
C
C   INPUT ARGUMENT LIST:
C     KRUN     - IS THE RUN OPTION READ IN FROM DATA CARDS.
C     IOPTN    - INTEGER FLAG READ IN FROM 1ST DATA CARD.
C     NOLVSR   - INTEGER   WORD NUMBER OF UPPER AIR LEVELS TO PROCESS.
C     LVLSAL   - ARRAY OF ALL LEVELS REQUESTED
C     LDZDTQ   - LOGICAL   FLAG = .TRUE. FOR MIDCYC, SET IN SUB KOPTN.
C              - = .FALSE. IF NOT MIDCYC.
C     LDZNEW   - LOGICAL   FLAG = .TRUE. FOR MIDCYC, SET IN SUB KOPTN.
C              - =  .FALSE. IF NOT MIDCYC.
C     WATPAP   - REAL*8 NAME OF FILE TO READ BY SUB READPA.
C
C   OUTPUT ARGUMENT LIST:
C     ITOUT    - INTEGER FLAG WITH RANGE FROM 1 THRU 13 , USED
C              - TO DETERMINE TYPE OF MAP BACKGROUND DATA IS TO BE
C              - DISPLAYED ON. ITOUT IS A FUNCTION OF KRUN AND IS
C              - SET IN SUB KOPTN.
C     IDUMPT   - INTEGER   2 WORD ARRAY CONTAINING THE DUMP TIME
C              - IN HOLLERTH IE. '10+4','0   '.
C     COMMON /LACAR / LACAR
C     COMMON /LFILES/ L14,L15,L18,L19,L20,L22
C     COMMON /MIDCYC/ MIDCYC
C     COMMON /TIMES / NANJI(12)
C     COMMON /WLONG0/ WLONG0
C
C REMARKS:
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN 77
C   MACHINE:  NAS
C
C$$$
C
      COMMON /LACAR / LACAR
      COMMON /LFILES/ L14,L15,L18,L19,L20,L22
      COMMON /MIDCYC/ MIDCYC
      COMMON /TIMES / NANJI(12)
      COMMON /WLONG0/ WLONG0
C
      CHARACTER*8 GRANPA
      CHARACTER*8 NEWPAP
      CHARACTER*8 UABPAP
      DATA        GRANPA    /'GRANPA  '/
      DATA        NEWPAP    /'NEWPAP  '/
      DATA        UABPAP    /'UABPAP  '/
      CHARACTER*8   WATPAP
C
C
      INTEGER    IDUMPT(2)
      INTEGER    LVLSAL(10)
      INTEGER    NINES
      DATA       NINES  /9999/
C
      LOGICAL    LCKOUT
C
      LOGICAL    L14
      LOGICAL    L15
      LOGICAL    L18
      LOGICAL    L19
      LOGICAL    L20
      LOGICAL    L22
      LOGICAL    LACAR
      LOGICAL    LDZDTQ
      LOGICAL    LDZNEW
      LOGICAL    MIDCYC
      LOGICAL    TMCHK
C
      DATA   INFILE           /0/
      DATA   KACAR            /20/
      DATA   KADUPA           /19/
      DATA   KARCFT           /14/
      DATA   KSATWN           /22/
      DATA   KTIROS           /15/
      DATA   KUABOG           /18/
C
  150 FORMAT(A8)
      LCKOUT = .FALSE.
      TMCHK = .FALSE.
C
      IF(KRUN .NE. 4) GO TO 500
C     ...FALL THROUGH FOR UAB PLOT ON NH PE OCTAGON.
  300 CONTINUE
      ITOUT = 3
      WATPAP(1:8) = UABPAP(1:8)
      RETURN
C
  500 CONTINUE
      IF(KRUN .NE. 5) GO TO 800
C     ...FALL THROUGH FOR LFM-NA SECTION ON AFOS WITH 105W VERTICAL.
      ITOUT = 4
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
  800 CONTINUE
      IF(KRUN .NE. 8) GO TO 900
C     ...COME HERE FOR 1-DOT ON NA SECTION -- LOOKS JUST LIKE 2-DOT.
      ITOUT = 1
      GO TO 910
C
  900 CONTINUE
      IF(KRUN .NE. 9) GO TO 1000
C     ...THIS IS THE 2-DOT.
      ITOUT = 2
      IF(.NOT. LACAR) GO TO 910
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
  910 CONTINUE
      IF(.NOT. MIDCYC) LDZDTQ = .TRUE.
      IF(.NOT. MIDCYC) LDZNEW = .TRUE.
      WATPAP(1:8) = NEWPAP(1:8)
      IF(IOPTN .NE. 1) RETURN
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1000 CONTINUE
      IF(KRUN .NE. 10) GO TO 1100
C     ...INITIALIZE HERE FOR A TIROS PLOT.
      ITOUT = 6
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1100 CONTINUE
      IF(KRUN .NE. 11) GO TO 1500
C     ...FALL FOR TROPIC PLOT ON MERC.
      ITOUT = 7
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1500 CONTINUE
      IF(KRUN .NE. 15) GO TO 1700
C     ...INITIALIZE FOR 1:20M NH.
      ITOUT = 8
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1700 CONTINUE
      IF(KRUN .NE. 17) GO TO 1800
C     ...FALL FOR GENERALIZED NH 1:40M PLOT.
      ITOUT = 10
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1800 CONTINUE
      IF(KRUN .NE. 18) GO TO 1900
C     ...AND THIS IS FOR GENERALIZED 1:40M SH PLOT.
      ITOUT = 5
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 1900 CONTINUE
      IF(KRUN .NE. 19) GO TO 2200
C     ...HERE I PLOT THE NH 1:60M.
      ITOUT = 11
      WATPAP(1:8) = GRANPA(1:8)
      LCKOUT = .TRUE.
      GO TO 2500
C
 2200 CONTINUE
      IF(KRUN .NE. 22) GO TO 2300
C     ...THIS IS A PSEUDO-GOES WEST PROJECTION.
      ITOUT = 12
      WLONG0 = 135.0
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 2300 CONTINUE
      IF(KRUN .NE. 23) GO TO 2400
C     ...THIS IS A PSEUDO-GOES EAST PROJECTION.
      ITOUT = 13
      WLONG0 = 75.0
      WATPAP(1:8) = GRANPA(1:8)
      GO TO 2500
C
 2400 CONTINUE
      IF((KRUN .GT. 0) .AND. (KRUN .LT. 24)) GO TO 300
C     ...DEFAULT TO 300 FOR A REASONABLE KRUN REQUEST.
      PRINT 2450,KRUN
 2450 FORMAT(1H ,'KRUN = ',I4,' ... OUT OF RANGE.')
      STOP 2100
C
 2500 CONTINUE
C
C          COME HERE TO READ DATA FILES AS INDICATED BY THE
C     SWITCHES SET IN /LFILES/.
C
C     FT19 ... ADPUPA
C
      IF(.NOT. L19) GO TO 2600
      INFILE = KADUPA
      IOPCLO = 2
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 2600
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 2600 CONTINUE
C
C     FT14 ... AIRCFT
C
      IF(.NOT. L14) GO TO 2700
      IF(INFILE .NE. 0) GO TO 2610
      IOPCLO = 2
      GO TO 2620
 2610 CONTINUE
      IOPCLO = 0
 2620 CONTINUE
      INFILE = KARCFT
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
      IF(IOPCLO .EQ. 0) GO TO 2700
        IF(TMCHK) GO TO 2700
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 2700
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 2700 CONTINUE
C
C     FT20 ... ACAR
C
      IF(.NOT. L20) GO TO 2800
      IF(INFILE .NE. 0) GO TO 2710
      IOPCLO = 2
      GO TO 2720
 2710 CONTINUE
      IOPCLO = 0
 2720 CONTINUE
      INFILE = KACAR
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
      IF(IOPCLO .EQ. 0) GO TO 2800
        IF(TMCHK) GO TO 2800
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 2800
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 2800 CONTINUE
C
C     FT22 ... SATWND
C
      IF(.NOT. L22) GO TO 2900
      IF(INFILE .NE. 0) GO TO 2810
      IOPCLO = 2
      GO TO 2820
 2810 CONTINUE
      IOPCLO = 0
 2820 CONTINUE
      INFILE = KSATWN
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
      IF(IOPCLO .EQ. 0) GO TO 2900
        IF(TMCHK) GO TO 2900
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 2900
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 2900 CONTINUE
C
C     FT15 ... TIROS
C
      IF(.NOT. L15) GO TO 3000
      IF(INFILE .NE. 0) GO TO 2910
      IOPCLO = 2
      GO TO 2920
 2910 CONTINUE
      IOPCLO = 0
 2920 CONTINUE
      INFILE = KTIROS
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
      IF(IOPCLO .EQ. 0) GO TO 3000
        IF(TMCHK) GO TO 3000
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 3000
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 3000 CONTINUE
C
C     FT18 ... BOGUS
C
      IF(.NOT. L18) GO TO 3100
      IF(INFILE .NE. 0) GO TO 3010
      IOPCLO = 3
      GO TO 3020
 3010 CONTINUE
      IOPCLO = 1
 3020 CONTINUE
      INFILE = KUABOG
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
      IF(IOPCLO .EQ. 1) GO TO 3100
        IF(TMCHK) GO TO 3100
        IF(NANJI(5) .EQ. NINES .OR. NANJI(6) .EQ. NINES) GO TO 3100
      IDUMPT(1) = NANJI(5)
      IDUMPT(2) = NANJI(6)
        TMCHK = .TRUE.
C
 3100 CONTINUE
C
C     I MAY STILL NEED TO CLOSE GRANPA.
C
      IF(IOPENQ .EQ. 0) GO TO 3200
      IOPCLO = 4
      CALL RDAFIL(INFILE,NOLVSR,LVLSAL,KRUN,
     1            IOPCLO,LCKOUT,IOPENQ,IERROR)
C
 3200 CONTINUE
      RETURN
      END
